function Ajax(e){this.method=e.method||"",this.url=e.url||"",this.callback=e.callback||"",this.data=e.data||""}var trans={chooseLan:"cmcm",optionVal:{cmcm:{},google:{},baidu:{},youdao:{}},queryVal:"",topNav:document.querySelector(".de-trans"),init:function(){var e=this,t=location.pathname;t.indexOf("update")>0?e.updateLog():(e.bindEvent(),window.onresize=function(){e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){e.bindEvent()},500)},e.searchHas())},updateLog:function(){var e="http://10.60.242.202:8090/trans",t={updatehistory:1},o=new Ajax({method:"post",url:e,callback:function(e){var e=e.updatehistory,t=e.length,o=[];if(o.push('<div class="log">最新更新</div>'),t>0){for(var a=0;a<t;a++){var n=e[a].content;o.push("<h4>"+e[a].time+"</h4>");for(var l in n)o.push('<div class="list">'+l+" 、"+n[l]+"</div>")}var r=document.querySelector(".main"),i=o.join("");console.log(o,i,r),r.innerHTML=i}},data:t});o.send()},bindEvent:function(){var e=this,t=document.querySelector(".copy"),o=document.querySelector(".after-lan"),a="200",n=!1;t.onclick=function(){e.oCopy(o)};var l=document.querySelector(".before-lan"),r=document.querySelector(".clear");l.oninput=function(t){if(e.timer&&clearTimeout(e.timer),this.value?r.style.display="block":(r.style.display="none",o.value=""),a<this.scrollHeight){var n=this.scrollHeight+"px";this.style.height=n,o.style.height=n}e.queryVal=this.value},r.onclick=function(){l.value="",r.style.display="none",s.value="",e.optionVal.google.data="",e.optionVal.cmcm.data="",e.optionVal.youdao.data="",e.optionVal.baidu.data="",o.style.height=a+"px",l.style.height=a+"px",n=!1};var i=document.querySelector(".submit"),c=document.querySelector(".before-opt"),u=document.querySelector(".before-lan"),d=document.querySelector(".after-opt"),s=document.querySelector(".after-lan"),p="http://10.60.242.202:8090/trans",y=(document.body.clientWidth,document.querySelector(".opt-type"));"none"==e.topNav.style.display&&(y.onchange=function(t){e.timer&&clearTimeout(e.timer);var o=y.value;return e.optionVal[o].type==e.queryVal&&""!=e.optionVal[o].data?(s.value=e.optionVal[o].data,!1):void(s.value="")}),i.onclick=function(t){if("block"==e.topNav.style.display){if(!u.value)return!1;t.preventDefault();var o=document.querySelector(".on");text=o.innerHTML,o.click(),e.optionVal[text].canSubmit=!0}else{t.preventDefault();var a={from:c.value,query:encodeURIComponent(e.queryVal),to:d.value,engine:y.value};s.setAttribute("placeholder","拼命加载中...");var n=new Ajax({method:"post",url:p,callback:function(t){var t=t.trans;s.value=t,e.optionVal[y.value].data=t,e.optionVal[y.value].type=e.queryVal,s.setAttribute("placeholder","")},data:a});n.send()}};for(var s=document.querySelector(".after-lan"),m=document.querySelector(".de-trans"),v=m.getElementsByTagName("li"),h=0,f=v.length;h<f;h++){var b=v[h];b.removeEventListener("click",e.boxClick,!0),b.addEventListener("click",e.boxClick,!0)}var g=window.location.search;g.indexOf("?")>0?g.split("?")[1].split("=")[1]:"";if(g.indexOf("debug")>0)for(var q=document.querySelectorAll(".debug"),h=0,f=q.length;h<f;h++)q[h].style.display="block"},addOn:function(e){for(var t=0,o=e.length;t<o;t++)e[t].className=""},boxClick:function(){var e=trans,t=document.querySelector(".de-trans"),o=t.getElementsByTagName("li");e.timer&&clearTimeout(e.timer),e.tab=!0;var a=this.getAttribute("data-value");e.addOn(o),this.className="on";var n=(document.querySelector(".submit"),document.querySelector(".before-opt")),l=document.querySelector(".before-lan"),r=document.querySelector(".after-opt"),i=document.querySelector(".after-lan"),c="http://10.60.242.202:8090/trans",u=(document.querySelector(".copy"),document.querySelector(".after-lan")),l=document.querySelector(".before-lan"),i=document.querySelector(".after-lan");u.style.height=Math.max(l.scrollHeight,i.scrollHeight)+"px";var d={from:n.value,query:encodeURIComponent(e.queryVal),to:r.value,engine:""};if(console.log(d),!l.value)return!1;if(e.optionVal[a].type==e.queryVal&&""!=e.optionVal[a].data)return i.value=e.optionVal[a].data,!1;switch(i.value="",e.optionVal[a].data="",i.setAttribute("placeholder","玩命加载中..."),a){case"google":e.chooseLan="google",d.engine=e.chooseLan,d.query=encodeURIComponent(e.queryVal);var s=new Ajax({method:"post",url:c,callback:function(t){var t=t.trans;e.optionVal.google.data=t,e.optionVal.google.type=e.queryVal,i.value=t,i.setAttribute("placeholder","")},data:d});s.send();break;case"youdao":e.chooseLan="youdao",d.engine=e.chooseLan;var s=new Ajax({method:"post",url:c,callback:function(t){var t=t.trans;e.optionVal.youdao.data=t,e.optionVal.youdao.type=e.queryVal,i.value=t,i.setAttribute("placeholder","")},data:d});s.send();break;case"cmcm":e.chooseLan="cmcm",d.engine=e.chooseLan;var s=new Ajax({method:"post",url:c,callback:function(t){var t=t.trans;e.optionVal.cmcm.data=t,e.optionVal.cmcm.type=e.queryVal,i.value=t,i.setAttribute("placeholder","")},data:d});s.send();break;case"baidu":e.chooseLan="baidu",d.engine=e.chooseLan;var s=new Ajax({method:"post",url:c,callback:function(t){var t=t.trans;e.optionVal.baidu.data=t,e.optionVal.baidu.type=e.queryVal,i.value=t,i.setAttribute("placeholder","")},data:d});s.send()}},oCopy:function(e){e.value&&(e.select(),document.execCommand("Copy"))},saveTextAsFile:function(e){var t=e,o=new Blob([t],{type:"text/plain"}),a="english.txt",n=document.createElement("a");n.download=a,n.innerHTML="Download File",null!=window.webkitURL?n.href=window.webkitURL.createObjectURL(o):(n.href=window.URL.createObjectURL(o),n.onclick=destroyClickedElement,n.style.display="none",document.body.appendChild(n)),n.click()},searchHas:function(){}};Ajax.prototype.send=function(e,t,o,a){var e=e||this.method,a=a||this.data,t=t||this.url,o=o||this.callback,n=new XMLHttpRequest;if(n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){var e=JSON.parse(n.responseText);o(e)}else console.log(n)},"get"===e){if("object"==typeof a){var l="?";for(var r in a)l+=r+"="+a[r],l+="&";l=l.slice(0,-1)}n.open(e,t+l,!0),n.send(null)}else{if("post"!==e)return console.log("不识别的方法:"+e),!1;n.open(e,t,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var i="";for(var c in a)i&&(i+="&"),i+=c+"="+a[c];n.send(i)}};var siblings=function(e){for(var t=[],o=e;e=e.previousSibling;)if(1===e.nodeType){t.push(e);break}for(e=o;e=e.nextSibling;)if(1===e.nodeType){t.push(e);break}return t};window.onload=function(){trans.init()};
